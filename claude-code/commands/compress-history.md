---
allowed-tools: Bash, Read, Write, Edit, MultiEdit, Grep, Glob, TodoWrite
description: Compress old conversation history while keeping recent history uncompressed
---

# Compress History Command

このコマンドは会話履歴を圧縮し、古い履歴は要約して、最近の履歴は詳細を保持します。

## 使用方法
```bash
/compress-history [options]
```

## 動作

1. **履歴の分析**
   - 現在の会話履歴を読み込む
   - タイムスタンプに基づいて古い履歴と最近の履歴を分類

2. **古い履歴の圧縮**
   - 7日以上前の履歴を要約形式に圧縮
   - 重要な決定事項やコード変更は保持
   - 繰り返しの議論は統合

3. **最近の履歴の保持**
   - 直近7日間の履歴は完全な形で保持
   - コンテキストの維持のため詳細を保存

## 実装

### ステップ1: 会話履歴の取得
現在の会話履歴を分析し、タイムスタンプで分類します。

### ステップ2: 古い履歴の要約
- トピックごとにグループ化
- 重要なポイントを抽出
- コード変更の記録を保持

### ステップ3: 最近の履歴の処理
- 直近の会話は圧縮せずに保持
- コンテキストの連続性を維持

### ステップ4: 結果の保存
圧縮された履歴と最近の履歴を統合して保存

## オプション

- `--days <number>`: 圧縮しない日数を指定（デフォルト: 7）
- `--level <low|medium|high>`: 圧縮レベルを指定
  - `low`: 軽い要約、詳細を多く保持
  - `medium`: 標準的な要約（デフォルト）
  - `high`: 積極的な要約、要点のみ保持

## 例

```bash
# 標準的な圧縮
/compact

# 最近14日間は圧縮しない
/compress-history --days 14

# 積極的に圧縮
/compress-history --level high
```

## 実行時の処理

以下の処理を順番に実行します：

1. 現在の会話履歴を確認
2. 時間に基づいて履歴を分類
3. 古い履歴を要約形式に変換
4. 最近の履歴はそのまま保持
5. 結果を表示して確認を求める
6. ユーザーの承認後、履歴を更新

---

## 実行内容

このコマンドを実行すると、以下の処理を行います：

1. **現在の会話履歴を分析**
   - プロジェクトディレクトリの履歴ファイルを読み込み
   - タイムスタンプに基づいて分類

2. **古い履歴の要約処理**
   - 指定された日数（デフォルト7日）より古い履歴を抽出
   - トピックごとにグループ化して要約
   - 重要な決定事項やコード変更は保持

3. **最近の履歴の保持**
   - 直近の履歴は詳細をそのまま保持
   - コンテキストの連続性を維持

4. **結果の確認と保存**
   - 圧縮前後の比較を表示
   - ユーザーの確認後、履歴を更新

このコマンドにより、会話履歴が効率的に管理され、メモリ使用量を削減しながら重要な情報は保持されます。